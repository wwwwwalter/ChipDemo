C51 COMPILER V9.60.0.0   I2C                                                               06/11/2019 17:33:36 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\Objects\I2C.obj
COMPILER INVOKED BY: C:\Dev\program\51keil9\C51\BIN\C51.EXE I2C.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Li
                    -stings\I2C.lst) OBJECT(.\Objects\I2C.obj)

line level    source

   1          #include <reg52.h>
   2          #include <intrins.h>
   3          #define I2CDelay() {_nop_();_nop_();_nop_();_nop_();}
   4          
   5          sbit SCL=P2^1;
   6          sbit SDA=P2^0;
   7          
   8          void I2CStart();
   9          void I2CStop();
  10          unsigned char I2CReadNAK();
  11          unsigned char I2CReadACK();
  12          bit I2CWrite(unsigned char dat);
  13          
  14          void I2CStart(){
  15   1              SDA=1;
  16   1              SCL=1;
  17   1              I2CDelay();
  18   1              SDA=0;
  19   1              I2CDelay();
  20   1              SCL=0;
  21   1      }
  22          
  23          void I2CStop(){
  24   1              SCL=0;
  25   1              SDA=0;
  26   1              I2CDelay();
  27   1              SCL=1;
  28   1              I2CDelay();
  29   1              SDA=1;
  30   1              I2CDelay();
  31   1      }
  32          
  33          bit I2CWrite(unsigned char dat){
  34   1              bit ack;
  35   1              unsigned char mask;
  36   1              
  37   1              for(mask==0x80;mask!=0;mask>>=1){
  38   2                      if((mask&dat)==0){
  39   3                              SDA=0;
  40   3                      }else{
  41   3                              SDA=1;
  42   3                      }
  43   2                      I2CDelay();
  44   2                      SCL=1;
  45   2                      I2CDelay();
  46   2                      SCL=0;
  47   2              }
  48   1              I2CDelay();
  49   1              SCL=1;
  50   1              ack=SDA;
  51   1              I2CDelay();
  52   1              SCL=0;
  53   1              return (~ack);  
  54   1      }
C51 COMPILER V9.60.0.0   I2C                                                               06/11/2019 17:33:36 PAGE 2   

  55          
  56          unsigned char I2CReadNAK(){
  57   1              unsigned char mask;
  58   1              unsigned char dat;
  59   1              SDA=1;
  60   1              for(mask=0x80;mask!=0;mask>>=1){
  61   2                      I2CDelay();
  62   2                      SCL=1;
  63   2                      if(SDA==0){
  64   3                              dat&=~mask;
  65   3                      }else{
  66   3                              dat|=mask;
  67   3                      }
  68   2                      I2CDelay();
  69   2                      SCL=0;
  70   2              }
  71   1              SDA=1;
  72   1              I2CDelay();
  73   1              SCL=1;
  74   1              I2CDelay();
  75   1              SCL=0;
  76   1              return dat;
  77   1      }
  78          
  79          unsigned char I2CReadACK(){
  80   1              unsigned char mask;
  81   1              unsigned char dat;
  82   1              SDA=1;
  83   1              for(mask=0x80;mask!=0;mask>>=1){
  84   2                      I2CDelay();
  85   2                      SCL=1;
  86   2                      if(SDA==0){
  87   3                              dat&=~mask;
  88   3                      }else{
  89   3                              dat|=mask;
  90   3                      }
  91   2                      I2CDelay();
  92   2                      SCL=0;
  93   2              }
  94   1              SDA=0;
  95   1              I2CDelay();
  96   1              SCL=1;
  97   1              I2CDelay();
  98   1              SCL=0;
  99   1              return dat;
 100   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    193    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
